# 插值与拟合

## 插值定义
在实际问题中，一个函数 ```y = f(x)``` 往往是通过实验观测得到的，仅仅已知函数 ```f(x)``` 在某区间 ```[a , b]``` 上一系列点上的值:
$$y_i=f(x_i), i=0,1,\cdots,n$$

当需要在这些节点 $x_0,x_1,\cdots,x_n$ 之间的点 ```x``` 上的函数值时，常用较简单的、满足一定条件的函数 $\varphi(x)$ 去代替 $f(x)$，也就是 $\varphi(x_k)$ 是 $y_k$ 的估计值，当然，$\varphi(x)$ 插值函数应该满足条件:
$$\varphi(x_i)=y_i,i=0,1,\cdots,n$$

也就说定义的插值函数应该满足已有数据 $x_i$ 到 $y_i$ 的映射（这也是合理的，不然随便定义插值函数，但是无参考性（准确性））
## 拟合定义
拟合是已知有限个数据点，求近似函数，但这里与插值不同，拟合并不要求拟合出的函数一定过已知数据点，只要求在某种意义上的它在这些点上的总偏差最小

***插值和拟合都是根据一组数据构造一个函数作为近似，由于近似的要求不同（插值要求过已知点，拟合要求某一标准下整体偏差最小），二者在数学方法上是完全不同的***

## 插值方法
### 分段线性插值
将两个相邻的节点用直线连起来，如此形成的一条折线就是分段线性插值函数（应该是最简单的插值方法）

分段线性插值函数记为 $I_n(x)$ , 它满足 $I_n(x_i)=y_i$ ， 并且在每个小区间 $[x_i,x_{i+1}]$ 上都是线性函数 $(i=0,1,\cdots,n-1)$

$I_n(x)$ 可以表示为 $I_n(x)=\sum\limits_{i=0}^ny_il_i(x)$，其中

$$l_i(x)=\begin{cases}
\frac{x-x_{i-1}}{x_i-x_{i-1}}, x \in [x_{i-1},x_i], 0 \lt i \leq n \\
\frac{x-x_{i+1}}{x_i-x_{i+1}}, x \in [x_{i},x_{i+1}], i = 0 \\
0 ， other \;cases
\end{cases}$$

***很好理解的是，分段数越多，插值误差越小，并且当用 $I_n(x)$ 计算 $x$ 点的插值时，只用到 $x$ 左右的两点（计算斜率，带代入计算），计算量与节点个数无关***

### 拉格朗日插值多项式
拉格朗日（Lagrange） 插值的基函数为:
$$\begin{align}
l_i(x) &=\frac{(x-x_0)\cdots(x-x_{i})(x-x_{i+1})\cdots(x-x_n)}{(x_i-x_0)\cdots(x_i-x_{i-1})(x_i-x_{i+1})\cdots(x_i-x_n)} \notag\\ 
&=\prod\limits_{j=0,j \neq i}^n\frac{x-x_j}{x_i-x_j}  \notag
\end{align}$$

$l_i(x)$ 是 ```n``` 次多项式，满足
$$l_i(x_j)=\begin{cases}
0 , j \neq i, \\
1 , j = i
\end{cases}$$

拉格朗日插值函数
$$L_n(x)=\sum\limits_{i=0}^ny_il_i(x)=\sum\limits_{i=0}^ny_i(\prod\limits_{j=0,j \neq i}^n\frac{x-x_j}{x_i-x_j})$$


***相对于分段线性插值，拉格朗日插值多项式更加光滑（精确度高），但是换来的代价是当 n 比较大时，计算代价要远高于分段线性插值***

### 样条插值

许多工程技术中提出的计算问题对插值函数的**光滑性**有较高要求，如飞机的机翼外形，内燃机的进、排气门的凸轮曲线，都要求曲线具有较高的光滑程度，不仅要连续，而且要有连续的曲率，这就导致了**样条插值**的产生
#### 样条函数的概念
**样条** （Spline） 本来是工程设计中使用的一种绘图工具，是富有弹性的细木条或细金属条。绘图员利用它把一些一直点连接成一条光滑曲线，并使连接点处有**连续的曲率**

数学上将具有一定光滑性的分段多项式称为样条函数。具体的说，给定区间 $[a,b]$ 的一个分划
$$\Delta: a=x_0 \lt x_1 \lt \cdots \lt x_{n-1} \lt x_n=b $$

如果函数 $S(x)$ 满足
* 在每个小区间 $[x_i,x_{i+1}] (i=0,1,\cdots,n-1)$ 上 $S(x)$ 是 ```m``` 次多项式
* $S(x)$ 在 $[ a,b ]$ 上具有 ```m-1``` 阶连续导数

则称 $S(x)$ 是关于分划 $\Delta$ 的 ```m``` 次样条函数，其图形为 ```m``` 次样条曲线

#### 三次样条插值

***最常用的插值函数，提供了良好的平衡，在保持计算效率的同时还提供了较高的插值精度和光滑性***


分段线性插值是一次样条插值

接下来介绍一下求解样条插值函数的过程

已知函数 $y=f(x)$ 在区间 $[\;a,b\;]$ 上的 ```n+1``` 个节点

$$ a=x_0 \lt x_1 \lt \cdots \lt x_{n-1} \lt x_n=b $$

上的值 $y_i=f(x_i)$  ， 求插值函数 $S(x)$， 使得 
1.  $S(x_i)=y_i(i=0,1,\cdots,n)$
2.  在每个小区间 $[x_i,x_{i+1}] (i=0,1,\cdots,n-1)$ 上 $S(x)$ 是 ```3``` 次多项式， 记为 $S_i(x)$
3. $S(x)$ 在区间内 二阶连续可微（可导（一元函数可微可导是等价的））

由条件 2
可列
$$\begin{align}S(x)&=\{S_i(x),x\in[x_i,x_{i+1}], i = 0,1,\cdots,n-1\} \notag\\ 
S_i(x)&=a_ix^3+b_ix^2+c_ix+d_i  \notag
\end{align}$$

式中 $a_i, b_i,c_i,d_i$ 为待定系数，为 ```4n``` 个
由条件 3, 有
$$\begin{cases}
S_i(x_{i+1})=S_{i+1}(x_{i+1}) \\
S'_i(x_{i+1})=S'_{i+1}(x_{i+1}) \quad i=0,1,\cdots,n-2 \\
S''_i(x_{i+1})=S''_{i+1}(x_{i+1})
\end{cases}$$

与 条件1 结合有 ```4n-2``` 个方程，为确定 ```4n``` 个参数，还需两个边界条件

常用的三次样条函数的边界条件有三种类型：
1. $S'(a) = y'_0$ , $S'(b)=y'_n$ 由这种边界条件建立的样条插值函数称为 $f(x)$ 的 完备三次样条插值函数
2. $S''(a) = y''_0$ , $S''(b)=y''_n$
3. $S'(a+0)=S'(b-0)$，$S''(a+0)=S''(b-0)$，此条件称为周期条件

## 曲线拟合方法
这里以线性最小二乘法为例


曲线拟合问题的提法是，已知一组（二维）数据，即平面上的 ```n``` 个点 $(x_i,y_i)， i=1,2,\cdots,n， x_i$ 互不相同，寻求一个函数 ```y=f(x)``` ，使 ```f(x)``` 在某种准则下与所有的数据点最为接近，即曲线拟合的最好

线性最小二乘法的基本思路
$$f(x)=a_1r_1(x)+a_2r_2(x)+\cdots+a_mr_m(x)$$

式子中： $r_k(x)$ 为事先选定的线性无关的函数 , $a_k$ 为待定系数 $(k=1,2,\cdots,m; m\lt n)$

拟合准则是使 $y_i(i=1,2,\cdots,n)$ 与 $f(x_i)$ 的距离 $\delta_i$ 最小，称为最小二乘准则

1. **系数 $a_k$ 的确定**
记 
$$J(a_1,\cdots,a_n)=\sum\limits_{i=1}^n\delta_i^2$$
为求 $a_1,\cdots,a_n$ 使 $J$ 达到最小，只需利用极值的必要条件 $\frac{\partial J}{\partial a_j}=0, (j=1,\cdots,m) $根据方程组进行求解


2. **函数 $r_k(x)$的选取**
面对一组数据 $(x_i,y_i)，i=1,2,\cdots,n$，用最小二乘法曲线拟合最关键的就是恰当的选取 $r_1(x),\cdots,r_m(x)$
常用的曲线有：
* 直线 $y=a_1x+a_2$
* 多项式 $y=a_1x^m+\cdots+a_mx+a_{m+1}$ （一般 $m = 2,3$, 不宜太高）
* 双曲线（一支） $y=\frac{a_1}{x}+a_2$
* 指数曲线 $y=a_1e^{a_2x}$

对于指数曲线，拟合前需作变量代换，化为对 $a_1,a_2$ 的线性函数

***已知一组数据，用什么样的曲线拟合最好，可以在直观判断的基础上，选几种曲线分别拟合，然后比较，看哪条曲线的最小二乘指标 J 最小***


## 何时用？
* **数据不完整**:  当有不完整的数据集并需要估计数据集中缺失的值时（也相当于数据的预处理）
* **数据平滑**: 当需要平滑嘈杂的数据以便更清晰地看到数据的趋势和模式时（拟合曲线可以使离散数据更直观）
* **函数关系建立**: 需要基于一组数据点找到一个数学函数来近似描述它们之间的关系时（一些建模题中的关系描述与分析）
* **预测分析**: 需要基于现有数据预测未来值的场合（拟合，这里拟合其实是预测类算法中的回归分析的一部分）


## 插值的优缺点
### 优点
* **精确度**: 插值提供了一种通过已知数据点精确估计未知数据点的方法。(这里的估计范围是数据范围内的估计)
* **保留数据特征**: 插值方法（尤其是样条插值）能够很好地保留数据的原始特征和结构。
### 缺点
* **不适用于外推**： 插值通常只适用于已知数据点的范围内，对于外推（预测已知数据范围外的点）效果不佳。
* **过度拟合**: 在数据点稀疏的情况下，插值可能导致过度拟合，产生不切实际的波动。

## 拟合的优缺点
### 优点
* **灵活性**： 拟合允许使用各种类型的函数（线性、非线性（指数，双曲线）等），为数据提供最佳拟合
* **适用于外推**：相对于插值，拟合方法更适合用于外推预测（相当于归纳分析出了系统的规律（拟合出的函数））
* **减少噪声影响**： 拟合可以减少数据中的随机噪声影响，提供更平滑的模型（数据预处理减少噪声使用（感觉不常用））
### 缺点
* **可能的误差**：  拟合模型很可能不会完全穿过所有数据点，这可能引入一些误差（离散数据用连续性规律总结总会有误差）
* **过度拟合或欠拟合风险**： 如果模型太复杂或太简单，可能导致过度拟合或欠拟合
* **模型选择和验证**：  需要合理选择模型类型，并进行严格的验证和测试（不同的基函数对模型的拟合效果不同，应比较多种基函数，选取最优基函数进行拟合）

