# 时间序列模型
将预测对象按照**时间顺序**排列起来，构成一个所谓的时间序列，从所构成的这一组时间序列过去的变化规律，推断**今后变化的可能性**以及**变化趋势**、**变化规律**，这就是时间序列预测法


时间序列模型其实是一种**回归模型**，其基于的原理是：
* 一方面承认事物发展的延续性，运用过去时间序列的数据进行统计分析就能推测事物的发展趋势
* 另一方面充分考虑到偶然因素影响而产生的随机性，为了消除随机波动的影响，利用历史数据，进行统计分析，并对数据进行适当的处理，进行趋势预测


## 确定性时间序列分析定义
***时间序列预测技术就是通过对预测目标自身时间序列的处理，来研究其变化趋势。***


一个时间序列往往是以下几类变化形式的叠加或耦合：
* **长期趋势变动**: 它是指时间序列朝着一定的方向持续上升或下降，或停留在某一水平上的倾向。也就是客观事物的**主要变化趋势**
* **季节变动**：序列的数据受到季节性的影响
* **循环变动**： 通常是指周期为一年以上，由非季节因素引起的涨落起伏波形相似的波动
* **不规则变动**： 通常分为**突然变动**或**随机变动**

通常用```Tt```表示长期趋势项，```St```表示季节变动趋势项，```Ct```表示循环变动趋势项，```Rt```表示随机干扰项。常见的时间序列模型:
* **加性模型**：

$$y_t=T_t+S_t+C_t+R_t$$
* **乘性模型**：

$$y_t=T_t*S_t*C_t*R_t$$
* **混合模型**：

$$y_t=T_t*S_t+R_t$$
$$y_t=S_t+T_t*C_t*R_t$$


在上述的式子中，$y_t$ 是观测目标的观察记录（也就是已知数据），均值$E(R_t)=0$,方差$Var(R_t)=\sigma^2$

也就是我们已知时间点```t```的数据$y_t$，然后去求解$y_t$的组成部分，即$T_t$，$S_t$，$C_t$，$R_t$


如果在预测时间范围以内，无**突然变动**且**随机变动**的方差$\sigma^2$较小，并且有理由认为**过去和现在的演变趋势**（找到的$T_t$等规律）将**继续发展到未来**时，可用一些经验方法进行预测


## 具体的方法
### 移动平均法
设观测序列为$y_1,\cdots,y_T$，取移动平均的项数 $N<T$，一次移动平均值的计算公式为

$$
\begin{align}
M_t^{(1)}&=\frac{1}{N}(y_t+y_{t-1}+\cdots+y_{t-N+1}) \notag\\
&=\frac{1}{N}(y_{t-1}+\cdots+y_{t-N})+\frac{1}{N}(y_t-y_{t-N})=M_{t-1}^{(1)}+\frac{1}{N}(y_t-y_N) \notag
\end{align}
$$
二次移动平均值计算公式为

$$M_t^{(2)}=\frac{1}{N}(M_t^{(1)}+\cdots+M_{t-N+1}^{(1)})=M_{t-1}^{(2)}+\frac{1}{N}(M_t^{(1)}-M_{t-N}^{(1)})$$


当我们的预测目标的数据的基本趋势是**在某一水平上下波动时**，可用**一次移动平均方法**建立预测模型
$$\hat{y}_{t+1}=M_t^{(1)}=\frac{1}{N}(y_t+\cdots+y_{t-N+1}), t = N, N+1, \cdots, T,$$

那么它的标准误差是
$$S=\sqrt{\frac{\sum\limits_{t=N+1}^T(\hat{y}_t-y_t)^2}{T-N}}$$

最近$N$期序列值的平均值作为未来各期的预测结果。一般 $N$ 取值范围:$5\leq N \leq 200$

当历史序列的**基本趋势变化不大**且**序列中随机变动成分较多**时， $N$ 的取值应该较大一些，否则 $N$ 的取值应该较小一些

在确定的**季节变动周期**的资料中，移动平均的项数应该取周期长度


总体来说，$N$ 的选取可以，比较其预测标准误差$S$，取预测标准误差最小者的 $N$

当预测目标的基本趋势与某一**线性模型**相吻合时，常用**二次移动平均法**，但序列同时存在线性趋势与周期波动时，可用**趋势移动平均法**建立预测模型，如下:
$$\hat{y}_{T+m}=a_T+b_Tm, m = 1, 2, \cdots$$
上述式子中的:
$$a_T=2M_T^{(1)}-M_T^{(2)};b_T=\frac{2}{N-1}(M_T^{(1)}-M_T^{(2)})$$


***移动平均法主要用于数据平滑处理，是一种非常简单的时间序列分析方法。主要用于消除数据中的随机波动，更清楚的展现数据的趋势（长期方向）和季节性（周期性波动）***

***在移动平均法中，通常是不会直接分解出上述提到的模型中的四种分量$T_t，S_t，C_t，R_t$。它实际上是对 $y_t$ 整体的估计，不会单独的分析每一个分量***

### 指数平滑法
一次移动平均实际上认为**最近 $N$ 期数据对未来的影响相同**，都加权 $1/N$ ，而 **$N$ 期以前的数据对未来值没有影响**

但是，二次以及更高次移动平均的权数却不是 $1/N$ ，且次数越高，权数越复杂，但永远保证**对称**的权数（两端权数小，中间权数大），这不符合一般系统动态性（**移动平均法的问题**）。

一般说来，历史数据对未来值的影响应该**随时间间隔的增长和递减**，指数平滑法就满足这个要求

***指数平滑法根据平滑次数的不同可以分为一次指数平滑法、二次指数平滑法以及三次指数平滑法***
#### 一次指数平滑法
1. 预测模型
设时间序列为$y_1,y_2,\cdots,y_t,\cdots,\alpha$ 为加权系数，$0 \lt \alpha \lt 1$，一次指数平滑公式为
$$S_t^{(1)}=\alpha y_t+(1-\alpha)S_{t-1}^{(1)}$$
***这个地方应该很熟悉，计网里面预测RTT是用到的，操作系统里进程调度时预测分配给进程的CPU时间也用到了***
这里的加权指的是**加权系数**呈指数分布
预测模型为:
$$\hat{y}_{t+1}=S_t^{(1)}$$
也就是:
$$\hat{y}_{t+1}=\alpha y_t+(1-\alpha) \hat{y}_t$$
第```t```期指数平滑值，作为第```t+1```期的预测值
2. 加权系数 $\alpha$ 的选择
遵循如下原则：
 * 如果时间序列波动不大，比较平稳，那么 $\alpha$ 应小一点，如0.1~0.5
 * 如果时间序列具有迅速且明显的变动倾向，那么 $\alpha$ 应大一点， 如 0.6~0.8
 * 当然，实际上也可以多取几个值进行试算，哪个预测误差小，就取哪个



3.  初始值的确定
有如下规则:
* 时间序列数据较多，在20个以上时，可选用第一个数值作为初始值 $s_0$
* 时间序列较少时，一般取最初几期实际值的平均值作为初始值



#### 二次指数平滑法
计算公式
$$
\begin{cases}
S_t^{(1)}=\alpha y_t +(1-\alpha) S_{t-1}^{(1)} \\
S_t^{(2)}=\alpha S_t^{(1)}+(1-\alpha) S_{t-1}^{(2)}
\end{cases}
$$
其中, $S_t^{(1)}$ 为一次指数平滑值，$S_t^{(2)}$ 为二次指数平滑值

当时间序列 ${y_t}$ 从某时期开始具有直线趋势时，可用直线趋势模型进行预测
$$\hat{y}_{t+m}=a_t+b_tm, m = 1, 2, \cdots \\
\begin{cases}
a_t=2S_t^{(1)}-S_t^{(2)}\\
b_t=\frac{\alpha}{1-\alpha}(S_t^{(1)}-S_t^{(2)})
\end{cases}$$


#### 三次指数平滑法
当时间序列的变动表现为**二次曲线**趋势时，则需要用**三次指数平滑法**

计算公式:
$$
\begin{cases}
S_t^{(1)}=\alpha y_t +(1-\alpha) S_{t-1}^{(1)} \\
S_t^{(2)}=\alpha S_t^{(1)}+(1-\alpha) S_{t-1}^{(2)} \\
S_t^{(3)}=\alpha S_t^{(2)}+(1-\alpha) S_{t-1}^{(3)}
\end{cases}
$$
$S_t^{(3)}$ 为三次指数平滑值

三次指数平滑法的预测模型为:
$$
\hat{y}_{t+m}=a_t+b_tm+c_tm^2, m = 1, 2, \cdots
$$
式中：
$$
\begin{cases}
a_t=3S_t^{(1)}-3S_t^{(2)}+S_t^{(3)}\\
b_t=\frac{\alpha}{2(1-\alpha)^2}[(6-5\alpha)S_t^{(1)}-2(5-4\alpha)S_t^{(2)}+(4-3\alpha)S_t^{(3)}]\\
c_t=\frac{\alpha ^2}{2(1-\alpha)^2}[S_t^{(1)}-2S_t^{(2)}+S_t^{(3)}]
\end{cases}$$

***差分指数平滑法很类似，普通的K阶指数平滑法是预测K-1次的曲线的，但是K阶差分指数平滑法可用预测K次曲线（因为取的是差分预测，差分可近似为求导（对曲线进行求导降低一阶））***

### 具有季节性特点的时间序列预测
