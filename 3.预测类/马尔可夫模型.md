# 马尔可夫模型
现实世界中有很多这样的现象，某一系统在已知现在情况的条件下，系统未来时刻的情况**只与现在有关**，**而与过去的历史**无直接关系

比如：研究一个商店的累计销售额，如果现在时刻的累计销售额已知，则未来某一时刻的累计销售额与现在时刻以前的任一时刻累计销售额无关。描述这类随机现象的数学模型称为**马尔可夫模型**，简称**马氏模型**

## 马尔可夫链的定义
设{ $\varepsilon_n, n= 1,2,\cdots$ }是一个随机序列，状态空间 ```E``` 有限或可列集，对于任意的正整数 ```m``` 以及 ```n```，若 $i,j, i_k \in E(k=1,\cdots,n-1)$ ， 有:
$$P\{ \varepsilon_{n+m}=j \;|\; \varepsilon_n=i，\varepsilon_{n-1}=i_{n-1},\cdots,\varepsilon_1=i_1 \}=P\{\varepsilon_{n+m}=j\;|\;\varepsilon_n=i\}$$
则称 { $\varepsilon_n, n= 1,2,\cdots$ } 是一个**马尔可夫链**，上述式子是**马氏性**


事实上，只要证明上述式子中当 ```m = 1``` 时成立，那它对于任意的正整数 ```m``` 都成立， 因此只要 ```m = 1``` 时上式成立，就可以称随机序列 { $\varepsilon_n, n= 1,2,\cdots$ } 具有马氏性，是一个马尔可夫链


***如果上式成立且与 n 无关， 那么称该马尔可夫链为时齐的***
即:
$$P\{\varepsilon_{n+m}=j\;|\;\varepsilon_n=i\}=p_{ij}(m)$$
其中 $p_{ij}(m)$ 是 系统由状态 ```i``` 经过 ```m``` 个时间间隔转移到状态 ```j``` 的转移概率。

时齐性的含义是系统从状态 ```i``` 到  状态 ```j``` 的 转移概率只依赖于时间间隔的长短（步长），与起始的时刻无关。

## 转移概率矩阵

$\mathbf{P}(m)=(p_{ij}(m))$ 为马尔可夫链的 ```m``` 步转移矩阵。 当 ```m = 1``` 时，$\mathbf{P}(1)=\mathbf{P}$ 称为马尔可夫的一步转移矩阵，或简称转移均值，具有三个基本性质:
* 对一切 $i,j \in E, \;0\leq p_{ij}(m) \leq 1$
* 对一切 $i \in E, \; \sum\limits_{j\in E}p_{ij}(m)=1$
* 对一切 $i, j \in E, p_{ij}(0)=\delta_{ij}=\begin{cases}1, i = j\\0, i \neq j\end{cases}$

当实际问题可以用马尔可夫链来进行描述时，首先要确定它的**状态空间** ```E``` 及**参数集合**，然后确定它的一步转移概率。概率的确定可以由问题的**内在规律**得到，也可以根据**观测数据进行统计**


***也就是说，系统的状态是有限的，类似于有限状态机，所有状态都已知（预测就是预测未来时间位于哪个已知状态），先统计或者说由内在规律得到状态转移的概率，然后根据概率转移来进行预测未来系统的状态***


接下来是一个递推 $\mathbf{P}(m)$ 的定理
**柯尔莫哥洛夫-开普霍定理**：
设 { $\varepsilon_n, n= 1,2,\cdots$ } 是一个马尔可夫链，其状态空间 $E={1,2,\cdots}$，则对任意正整数 ```m``` 以及 ```n```，有：
$$p_{ij}(n+m)=\sum\limits_{k \in E}p_{ik}(n)p_{kj}(m)，$$
其中: $i,j \in E$

设 $\mathbf{P}$ 是一步马尔可夫链转移矩阵， $\mathbf{P}^{(0)}$ 是 初始分布行向量，则第 ```n``` 分布行向量，则第 ```n``` 步的概率分布为：
$$P^{(n)}=P^{(0)}P^n$$

其中 $P$ 为转移概率矩阵


## 建模步骤
1. **问题定义**
* 明确模型的目标和范围(能否用马尔可夫模型去解决)
* 确定模型需要解决的具体问题
2. **确定状态空间**
* 定义所有可能的状态
* 这些状态应该是互斥的，且覆盖所有可能的情况（类似于编译原理中的有限状态机的）
3. **估计转移概率**
* 分析数据，估计状态间的转移概率（通常是一步转移矩阵）
4. **构建马尔可夫模型**
* 基于定义的状态和估计的转移概率构建模型
* 确定初始状态或初始状态分布（初始状态位于状态空间中每一个状态的概率值，是一个行向量就是上述式子中的 $P^{(0)}$）

5. **模型验证和测试**
* 使用已有的数据或情景测试模型的准确性（优化问题）
* 调整模型参数以提高预测的准确性
6. **模型应用和解释**
* 使用模型进行预测或决策支持


***建立马尔可夫模型可能需要对模型进行多次迭代和细致的调整，以确保其精度和适用性。模型的有效性不仅取决于理论构建，还取决于数据的质量和模型参数的准确性***。

## 模型优点
* **简单性和直观性**: 马尔可夫模型结构简单，易于理解和实现，特别是在状态空间有限的情况下（定义状态集合，统计或根据内在规律求出一步概率转移矩阵）
* **无记忆性**： 马尔可夫模型的主要特点是无记忆性，即未来状态仅依赖于当前状态，这简化了复杂系统的建模（这里指的是可简化的情况，不然就要用其它方法）
* **适用性**: 特别适合于那些状态转换具有明显随机性的系统，如随机游走、排队理论等(***咱们好像做港口那一题就是用的排队论加马尔可夫链***)。
* **灵活性**： 可以通过调整状态和转移概率来适应不同的应用场景
## 模型缺点
* **过度简化**: 正如优点里所提到的，实际上面对预测问题，通常是需要过去的信息的，这就导致马尔可夫模型不能处理这类问题
* **状态空间的限制**： 马尔可夫状态空间是有限的，也就是说，他只能预测比如股票的涨、跌、平，但它不能预测具体的数值（状态必须是有限的）
* **数据需求**: 数据的质量和数量直接影响模型的准确性（预测是完全基于概率转移矩阵）。
* **动态性限制**： 标准马尔可夫模型不适用于那些状态转移概率随时间变化的系统，状态空间**有限且静态**。
## 与其它模型的比较
* **时间序列模型** : 用于分析和预测随时间连续变化的数据，强调历史数据的影响。而马尔可夫模型更强调状态之间的转移，不考虑历史数据。
* **微分方程模型&&差分方程模型**: 些模型通常基于物理法则或其他理论，适用于连续或离散的动态系统。马尔可夫模型则更侧重于描述系统的**随机性**。
* **灰色预测模型**: 灰色预测模型适用于数据量较少且信息不完全的情况，强调对系统整体趋势的预测。马尔可夫模型侧重于状态间的随机转移

总体而言，马尔可夫模型在处理具有**明确状态和随机状态转移**的系统时表现出独特优势，但在处理复杂的动态系统或长期历史依赖的数据时不如其他模型有效。

面对预测性问题，选择合适的模型时，需要考虑**数据的特性**、**问题的性质**以及**模型的适用范围**。
